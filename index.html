<!DOCTYPE>
<html lang="en">
	<head>
		<meta charset="utf-8">

		<title>Jamwhiz, a drinking game without alcool</title>
		<!-- include js -->
		<script src="/client/js/gest.min.js"></script>
		<script src="/client/js/p5.min.js"></script>
		<script src="/client/js/p5.play.js"></script>
		<script src="/socket.io/socket.io.js" type="text/javascript"></script>
		<script src="/client/js/socketCommands.js"></script>
	</head>

	<body>
		<script type="text/javascript">
			// gestur detection saved in a global variable
	    var detectedDirection;
			gest.options.subscribeWithCallback(function(gesture) {
				if (gesture.direction) {
          detectedDirection = gesture.direction;
				}
      });
			gest.start();

      //socket stuff
      var playersCount, playerPosition, positionPlayerLeft, positionPlayerRight;
			socketCommands();
      onNewPlayer(function(playerPool){
        playersCount = playerPool.playersCount,
        playerPosition = playerPool.playerPosition;
        // player right position
        if(playerPosition === playersCount){
          positionPlayerRight = 1;
        }else{
          positionPlayerRight = playerPosition + 1;
        }
        //player left position
        if(playerPosition === 1){
          positionPlayerLeft = PlayersCount;
        }else{
          positionPlayerLeft = playerPosition - 1;
        }
      });

      // animation
      var sun;
      function preload(){
        sun = loadAnimation("/img/sun1.png","/img/sun2.png","/img/sun3.png");
      }

      function setup(){
        createCanvas(800, 600);
        background(77, 210, 255);
        position = createVector(400,0);
        velocity = createVector(0.0,0.9);
      }

      function draw() {
        position.add(velocity);
        background(77, 210, 255);
        if(position.y > 400 && position.y < 600){
          //this is the moment where you can hit the ball
          if(detectedDirection == "Left"){
            velocity.y = velocity.y + -0.1;
            velocity.x = velocity.x + -0.1;
            slapBall(positionPlayerLeft);
          }
          if(detectedDirection == "Right"){
            velocity.y = velocity.y + -0.1;
            velocity.x = velocity.x + 0.1;
            slapBall(positionPlayerRight);
          }
          strokeWeight(2);
          fill(127);
          ellipse(position.x, position.y, 300, 300);
        }

        animation(sun,position.x, position.y);
      }
		</script>
	</body>
</html>
